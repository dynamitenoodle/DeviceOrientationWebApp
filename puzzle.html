<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0" />
    <title>Gleckner-Puzzle</title>
    <link rel="stylesheet" type="text/css" href="puzzleStyle.css">
    <!--
        The Canvas Guide
         https://www.w3schools.com/html/html5_canvas.asp
        The making a game in javascript guide
         https://msdn.microsoft.com/en-us/library/gg589497(v=vs.85).aspx 
        Creating more basic shapes
         https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Drawing_shapes
    -->
</head>

<body>
    <canvas id="myCanvas" width="500" height="500">
    </canvas>
    <div class="ball"></div>
    
    <pre class="output"></pre>
</body>

<script>
    // window functions
    window.onload = function() { start(); };
    window.addEventListener("deviceorientation", handleOrientation, true);

    // the update loop interval
    setInterval(gameLoop, 1000 / 33);

    // attributes
    let c = document.getElementById("myCanvas");
    let ctx = c.getContext("2d");
    let back = new Image();
    let lineX = 0;
    let lineY = 0;
    let first = true;

    // ball stuff
    let ball   = document.querySelector('.ball');
    let garden = document.querySelector('.garden');
    let output = document.querySelector('.output');

    let maxX = c.clientWidth  - ball.clientWidth;
    let maxY = c.clientHeight - ball.clientHeight;

    // what happens at the start of the game
    function start(){
        drawGameBoard();
    }
    
    // drawing the game board
    function drawGameBoard(){
        // background
        ctx.fillStyle = "black";
        
        ctx.fillRect(0, 0, 500, 500);
        ctx.clearRect(15, 15, 470, 470);
        back = ctx.getImageData(0, 0, 30, 30);
        

        /*  ctx.moveTo(0,0); ctx.lineTo(0,500);  ctx.stroke();  */
    }

    function gameLoop() {
        // Do stuff.
        if (first){
            ctx.fillStyle = "black";
            ctx.moveTo(0,0); 
            ctx.lineTo(lineX++,lineY++);  
            ctx.stroke();
        }

        else {
            ctx.moveTo(500, 0);
            ctx.lineTo(lineX--, lineY++)
            ctx.stroke();
        }

        if (lineX == 500 && lineY == 500){
            lineX = 500;
            lineY = 0;
            first = false;
        }
        
    }

    function handleOrientation(event) {
      var x = event.beta;  // In degree in the range [-180,180]
      var y = event.gamma; // In degree in the range [-90,90]

      output.innerHTML  = "beta : " + x + "\n";
      output.innerHTML += "gamma: " + y + "\n";

      // Because we don't want to have the device upside down
      // We constrain the x value to the range [-90,90]
      if (x >  90) { x =  90};
      if (x < -90) { x = -90};

      // To make computation easier we shift the range of 
      // x and y to [0,180]
      x += 90;
      y += 90;

      // 10 is half the size of the ball
      // It center the positioning point to the center of the ball
      ball.style.top  = (maxX*x/180 - 10) + "px";
      ball.style.left = (maxY*y/180 - 10) + "px";
    }
</script>

</html>